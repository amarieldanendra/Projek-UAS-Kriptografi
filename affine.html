<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />
    <title>Enkripsi Affine Cipher</title>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a href="./index.html">Kriptografi</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="./affine.html">Affine Cipher</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./columnar.html">Columnar Cipher</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="judul">
      <h1>Affine Cipher Calculator</h1>
    </div>
    <!-- Enkripsi -->
    <div class="row">
      <div class="col-lg-6 col-md-6">
        <div class="card pt-4 pb-4 px-4">
          <div class="input">
            <h4 style="text-align: center">Enkripsi</h4>
            <p>Masukan kunci a</p>
            <input style="padding: 10px" id="nilaiA" type="text" name="mult"  /><br /><br />
            <p>Masukan kunci b</p>
            <input style="padding: 10px" id="nilaiB" type="text" name="add"  /><br /><br />
            <p>Masukan Plaintext</p>
            <textarea style="padding: 10px" id="plain" name="p" row="2"></textarea><br /><br />
          </div>
          <button type="button" class="btn" name="btnEn" style="border-color: black" onclick="encrypt()">Enkripsi</button><br /><br />
          <div class="output">
            <p>Ciphertext</p>
            <textarea id="hasilE" name="c" row="2" readonly></textarea>
          </div>
        </div>
      </div>
        

      <!-- Dekripsi -->
      <div class="col-lg-6 col-md-6">
        <div class="card pt-4 pb-4 px-4">
          <div class="input">
            <h4 style="text-align: center">Dekripsi</h4>
            <p>Masukan kunci a</p>
            <input style="padding: 10px" id="nilaiA" type="text" name="mult"  /><br /><br />
            <p>Masukan kunci b</p>
            <input style="padding: 10px" id="nilaiB" type="text" name="add"  /><br /><br />
            <p>Masukan Ciphertext</p>
            <textarea style="padding: 10px" id="cipher" name="c" row="2"></textarea><br /><br />
          </div>
          <button type="button" class="btn" name="btnEn" style="background-color: #2B3A55;" onclick="decrypt()">Dekripsi</button><br /><br />
          <div class="output">
            <p>Plaintext</p>
            <textarea id="hasilD" name="c" row="2" readonly></textarea>
          </div>
        </div>
      </div>
  </body>

  <script>
    const letter = "abcdefghijklmnopqrstuvwxyz";
    const encode = (phrase, key) => {
      if (gcd(key.a, letter.length) !== 1) {
        throw new Error("a and b must be coprime.");
      }

      let encodedPhrase = "";
      let whiteSpaceCounter = 0;

      for (let i = 0; i < phrase.length; i++) {
        if (/[0-9]/.test(phrase[i])) {
          encodedPhrase += phrase[i];
          whiteSpaceCounter += 1;
        } else {
          const x = letter.split("").findIndex((c) => c === phrase[i].toLowerCase());

          if (x > -1) {
            const e = (key.a * x + key.b) % letter.length;
            encodedPhrase += letter[e];
            whiteSpaceCounter += 1;
          }
        }
      }
      return encodedPhrase;
    };

    const decode = (phrase, key) => {
      if (gcd(key.a, letter.length) !== 1) {
        throw new Error("a and b must be coprime.");
      }

      let decodedPhrase = "";
      let whiteSpaceCounter = 0;

      for (let i = 0; i < phrase.length; i++) {
        if (/[0-9]/.test(phrase[i])) {
          decodedPhrase += phrase[i];
          whiteSpaceCounter += 1;
        } else {
          const y = letter.split("").findIndex((p) => p === phrase[i].toLowerCase());

          if (y > -1) {
            const d = (mmi * y - key.b) % letter.length;
            decodedPhrase += letter[d];
            whiteSpaceCounter += 1;
          }
        }
      }
      return decodedPhrase;
    };

    const gcd = (a, b) => {
      if (!b) {
        return a;
      }
      return gcd(b, a % b);
    };

    const mmi = (a, m) => {
      for (let x = 1; x < m; x++) {
        if (((a % m) * (x % m)) % m == 1) {
          return x;
        }
      }
    };

    function encrypt() {
      const nilaiA = parseInt(document.getElementById("nilaiA").value);
      const nilaiB = parseInt(document.getElementById("nilaiB").value);
      const plaintext = document.getElementById("plain").value;
      const keys = { a: nilaiA, b: nilaiB };
      let encodeHasil = encode(plaintext, keys);
      document.getElementById("hasilE").innerHTML = encodeHasil;
      document.getElementById("hasilE").value = encodeHasil;
      console.log(nilaiA);
      console.log(nilaiB);
      console.log(encodeHasil);
    }

    function decrypt() {
      const nilaiA = parseInt(document.getElementById("nilaiA").value);
      const nilaiB = parseInt(document.getElementById("nilaiB").value);
      const ciphertext = document.getElementById("cipher").value;
      const keys = { a: nilaiA, b: nilaiB };
      let decodeHasil = decode(ciphertext, keys);
      document.getElementById("hasilD").innerHTML = decodeHasil;
      document.getElementById("hasilD").value = decodeHasil;
      console.log(nilaiA);
      console.log(nilaiB);
      console.log(decodeHasil);
    }
  </script>
</html>
